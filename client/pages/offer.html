<!doctype html>
<html lang="en">
<script>
  (async function () {
    const token = localStorage.getItem('token');
    if (!token) {
      location.href = 'log-in-offer.html';
      return;
    }
    try {
      const res = await fetch('/api/auth/me', {
        method: 'GET',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      if (!res.ok) throw new Error();
      const me = await res.json();
      localStorage.setItem('userId', me._id);  // <-- save userId for later
    } catch (err) {
      localStorage.removeItem('token');
      location.href = 'log-in-offer.html';
      return;
    }
  })();
</script>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
  <title>Claim my plan</title>
  <!-- 1Ô∏è‚É£  LOAD the real Stripe SDK first (blocks parsing, 30 ms) -->
  <link rel="preconnect" href="https://js.stripe.com" crossorigin>
  <link rel="preconnect" href="https://api.stripe.com" crossorigin>
  <link rel="preconnect" href="https://m.stripe.network" crossorigin>
  <link rel="dns-prefetch" href="https://r.stripe.com">
  <!-- <script
    src="https://www.paypal.com/sdk/js?client-id=AcygnP6DJSFGbIeyUa2BdGdznCQQk-qXjMEMijIZJeTbzkIltNVCGL5k1i2DdcNR24qoGTDPF_FD_VQ8&currency=GBP&vault=true&intent=subscription&components=buttons,marks&disable-funding=card"></script> -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- 2Ô∏è‚É£  SAVE an immutable reference before *anything* else can touch it -->
  <script>
    window.StripeReal = window.Stripe;                    // keep a copy
    Object.defineProperty(window, 'Stripe', {             // freeze it
      value: window.Stripe,
      writable: false,
      configurable: false
    });
  </script>


  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Roboto:wght@400&display=swap"
    rel="stylesheet">
  <link href="../styles/offer.css" rel="stylesheet">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W9CSNHSLQQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-W9CSNHSLQQ');
  </script>
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "rmf0p7sik4");
  </script>
  <!-- TikTok Pixel Code Start -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "enableCookie", "disableCookie", "holdConsent", "revokeConsent", "grantConsent"], ttq.setAndDefer = function (t, e) { t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++)ttq.setAndDefer(ttq, ttq.methods[i]); ttq.instance = function (t) {
        for (
          var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++)ttq.setAndDefer(e, ttq.methods[n]); return e
      }, ttq.load = function (e, n) {
        var r = "https://analytics.tiktok.com/i18n/pixel/events.js", o = n && n.partner; ttq._i = ttq._i || {}, ttq._i[e] = [], ttq._i[e]._u = r, ttq._t = ttq._t || {}, ttq._t[e] = +new Date, ttq._o = ttq._o || {}, ttq._o[e] = n || {}; n = document.createElement("script")
          ; n.type = "text/javascript", n.async = !0, n.src = r + "?sdkid=" + e + "&lib=" + t; e = document.getElementsByTagName("script")[0]; e.parentNode.insertBefore(n, e)
      };


      ttq.load('D0M3KORC77UCAFR1EOLG');
      ttq.page();
    }(window, document, 'ttq');
  </script>
  <!-- TikTok Pixel Code End -->
  <!-- Meta Pixel Code -->
  <script>
    !function (f, b, e, v, n, t, s) {
      if (f.fbq) return; n = f.fbq = function () {
        n.callMethod ?
          n.callMethod.apply(n, arguments) : n.queue.push(arguments)
      };
      if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
      n.queue = []; t = b.createElement(e); t.async = !0;
      t.src = v; s = b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t, s)
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '2589073464764526');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=2589073464764526&ev=PageView&noscript=1" /></noscript>
  <!-- End Meta Pixel Code -->
</head>

<body>
  <div id="loaderOverlay" class="loader-overlay">
    <img src="../assets/rtb-logo-white.png" alt="Raising The Bar logo" class="loader-logo" />
  </div>
  <div class="header">
    <div class="logo">
      <a href="../index.html">
        <img id="logo" class="logo" src="../assets/rtb-logo-white.png" alt="Raising The Bar Logo">
      </a>
    </div>
  </div>


  <div class="offer-container">
    <div id="bodyTypeProgress" class="btp-wrapper">
      <div class="btp-img-group">
        <figure class="btp-col">
          <img id="btpCurrentImg" src="" alt="Current body type" />
          <figcaption class="visually-hidden">Now</figcaption>
        </figure>

        <span class="btp-arrow" aria-hidden="true">
          <!--  size = viewBox; stroke inherits colour  -->
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="3"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 24h32" />
            <polyline points="30 14 40 24 30 34" />
          </svg>
        </span>

        <figure class="btp-col">
          <img id="btpTargetImg" src="" alt="Desired body type" />
          <figcaption id="btpDays" class="visually-hidden">30&nbsp;Days</figcaption>
        </figure>
      </div>

      <div class="btp-stats-table">
        <!-- NOW column -->
        <div class="btp-stat-col now">
          <h5 class="btp-period">Now</h5>

          <div class="btp-stat">
            <span class="btp-label">Body¬†fat</span>
            <span class="btp-value" id="bodyFatNow">20‚Äë24%</span>
          </div>

          <div class="btp-stat">
            <span class="btp-label">Body¬†muscles</span>
            <div class="btp-bars" id="muscleBarsNow"></div>
          </div>
        </div>

        <!-- GOAL column -->
        <div class="btp-stat-col goal">
          <!-- text filled dynamically in JS -->
          <h5 class="btp-period" id="goalPeriod">‚Äë</h5>

          <div class="btp-stat">
            <span class="btp-label">Body¬†fat</span>
            <span class="btp-value">8‚Äë10%</span>
          </div>

          <div class="btp-stat">
            <span class="btp-label">Body¬†muscles</span>
            <div class="btp-bars" id="muscleBarsGoal"></div>
          </div>
        </div>
      </div>

      <p class="btp-disclaimer">
        Images are illustrative only - results vary by individual.
      </p>
    </div>
    <!-- <p class="plan-diff-text-0">
      <strong>No other app does what we do.</strong><br>
      Other apps just track. <strong>We use what you track to adapt workouts & meals</strong> so you
      <strong>get fit faster</strong>.
      <a href="#compare-plans" id="comparePlansLink0" class="compare-pill">
        üîé See how it compares
      </a>
    </p> -->

    <div id="dynamicMessageContainer" class="personalized-box">
      <!-- Dynamic content will go here -->

    </div>

  </div>


  <div class="whats-included-container">
    <h2 class="wi2-heading">Inside Your Plan</h2>
    <p class="wi2-description">Everything you need to stay consistent ‚Äî workouts, meals, and progress that adjust as you
      go.</p>

    <div class="wi2-content">
      <!-- LEFT: Subheadings with 50px margin between them -->
      <div class="wi2-left">
        <div class="wi2-item active ct-item" data-index="0">
          <h4><span class="tick ct-tick">‚úî</span> Personalized Workout Plan</h4>
        </div>
        <div class="wi2-item ct-item" data-index="1">
          <h4><span class="tick ct-tick">‚úî</span> Clear and easy to follow</h4>
        </div>
        <div class="wi2-item pt-item" data-index="2">
          <h4><span class="tick pt-tick">‚úî</span> Visible Results in 4 Weeks</h4>
        </div>
        <div class="wi2-item pt-item" data-index="3">
          <h4><span class="tick pt-tick">‚úî</span> Progress tracking and analysis</h4>
        </div>
        <!-- <div class="wi2-item pt-item" data-index="4">
          <h4><span class="tick pt-tick">‚úî</span> Flexible Logging</h4>
        </div>
        <div class="wi2-item ct-item" data-index="5">
          <h4><span class="tick ct-tick">‚úî</span> Daily Streaks</h4>
        </div>
        <div class="wi2-item pt-item" data-index="6">
          <h4><span class="tick pt-tick">‚úî</span> Your Fitness Story, Visualized</h4>
        </div>
        <div class="wi2-item pt-item" data-index="7">
          <h4><span class="tick pt-tick">‚úî</span> One Score That Tracks It All</h4>
        </div> -->
      </div>



      <!-- RIGHT: pinned container, 
           so it doesn't appear above the 1st item or below the last item. -->
      <div class="wi2-right">
        <div class="wi2-sticky">
          <!-- The pinned panel that never goes higher than the first heading or lower than the last -->
          <div class="wi2-panel">
            <div class="wi2-image-container fade-stage" id="wi2-image-container">
              <img id="wi2-image" class="-panel" src="#" alt="Whats Included Image" />
            </div>
            <div class="wi2-desc-container fade-stage" id="wi2-desc-container">
              <p id="wi2-desc" class="-panel">
                A plan customized to your fitness level, goals, and lifestyle for real, sustainable results.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <section class="app-social-proof" aria-label="App social proof">
    <div class="asp-inner">

      <!-- Laurel + headline -->
      <div class="asp-laurels" aria-hidden="true">
        <!-- left leaf -->

        <h3 class="asp-headline">
          <span class="asp-number">10&nbsp;Million+</span>
          <br>
          kick‚Äëstarted their journey with us
        </h3>

      </div>

      <!-- rating + store badges -->
      <div class="asp-rating">
        <span class="asp-stars" aria-label="Star rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
        <span class="asp-score">4.7&nbsp;/&nbsp;5</span>

        <!-- store badges ‚Äì use your own assets if you prefer -->
        <img src="../assets/apple-pay-mark.webp" alt="App¬†Store" loading="lazy">
        <img src="../assets/google-play.png" alt="Google¬†Play" loading="lazy">
      </div>

      <p class="asp-reviews">250&nbsp;000+ five‚Äëstar reviews from happy users</p>
    </div>
  </section>

  <div class="results-section " id="results-section">
    <!-- <h2 class="results-heading">
      Adapts to You. Built to Last.
    </h2>
    <p class="results-description">
      No more spreadsheets. No more overthinking. Your training, meals, and progress are all connected ‚Äî adapting to
      your life so you can finally stay consistent.
    </p>

    <section class="youtube-prompt-section">
      <div class="youtube-video-container"
        style="position: relative; padding-top: 56.25%; height: 0; overflow: hidden;">
        <div id="youtube-placeholder" style="
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      cursor: pointer;
      background: url('https://img.youtube.com/vi/H_aOWlPujIg/hqdefault.jpg')
                  center center / cover no-repeat;
    ">
          <div style="
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0,0,0,0.6);
        border-radius: 50%; padding: 12px;
      ">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 5v14l11-7z" />
            </svg>
          </div>
        </div>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const placeholder = document.getElementById("youtube-placeholder");
          placeholder.addEventListener("click", function () {
            const iframe = document.createElement("iframe");
            iframe.setAttribute(
              "src",
              "https://www.youtube.com/embed/H_aOWlPujIg?autoplay=1"
            );
            iframe.setAttribute("frameborder", "0");
            iframe.setAttribute(
              "allow",
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            );
            iframe.setAttribute("allowfullscreen", "");
            iframe.style.cssText = `
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
      `;
            placeholder.replaceWith(iframe);
          });
        });
      </script>

    </section> -->

    <h2 class="complete-workout-heading">
      Complete Workout Program
    </h2>
    <ul class="workout-benefits">
      <li>Workouts that adapt to your performance and evolve with you</li>
      <li>Macro-matched meals ‚Äî precision without the logging stress</li>
      <li>Coach-style insights that track your habits, progress, and consistency</li>
    </ul>
  </div>

  <!-- Testimonials / Social Proof -->
  <div class="review-section">
    <h3>This Isn‚Äôt Just Progress ‚Äî It‚Äôs Personal</h3>

    <div class="before-after-images">
      <div class="before-image">
        <img src="#" alt="Before">
        <p class="image-label">Before</p>
      </div>
      <div class="after-image">
        <img src="#" alt="After">
        <p class="image-label">After</p>
      </div>
    </div>

    <div class="review-container">
      <div class="testimonial-info">
        <div class="testimonial-left">
          <strong>Bob</strong>
        </div>
        <div class="testimonial-right">
          <img src="../assets/5-stars.png" alt="5 Stars" class="star-rating">
        </div>
      </div>
      <div class="review-placeholder">
        <p>I was skeptical at first, but within a few weeks I noticed remarkable changes and felt amazing!</p>
      </div>
    </div>


    <p class="testimonial-disclaimer">
      Results may vary. This transformation was achieved using the <strong>12-Week Plan</strong>, part of our tailored
      training system.
    </p>
  </div>

  <div class="floating-cta-container" id="floatingCtaContainer">
    <div class="floating-cta -cta" id="floating-cta">
      <button id="claimProgramBtn" class="claim-program-btn">
        Claim My Plan
      </button>
    </div>
  </div>

  <div id="ctaStopContainer"></div>

  <section class="discount-section" id="discountSection">
    <!-- Timer Container -->
    <div class="timer-container" id="timerContainer">
      <div class="timer-text">
        <span class="discount-label">Discount Expires In:</span>
        <span class="time-remaining" id="countdownTimer">10:00</span>
      </div>
      <p class="first-1000">üî• 1,500+ people unlocked their plan today.<br>You're next.</p>
    </div>

    <!-- Offer Cards -->
    <section id="socialProof" class="social-proof">
      <img src="../assets/muscular-silhouette.webp" alt="Muscular Man" class="social-proof__coach" />
      <p class="social-proof__headline">
        947 people bought workout plans in the last hour
      </p>
      <div class="social-proof__recent">
        <span class="social-proof__tag">ava 12-Week Plan</span>
        <span class="social-proof__tag">ethan 12-Week Plan</span>
      </div>
    </section>
    <h3 class="offer-heading" id="path-to-progress">Pick Your Path to Progress</h3>
    <p class="plan-diff-text">
      Other apps just track.
      <strong>We use what you track to adapt workouts & meals</strong> so you
      <strong>get fit faster</strong>.<br>

      <a href="#" id="comparePlansLink" class="compare-pill">
        üîé See how it compares
      </a>
    </p>
    <!-- <p class="offer-subtext">Most people never stick to fitness because their plan doesn‚Äôt adapt. Yours will.
    </p> -->

    <div class="offer-cards" id="offerCardsContainer">
      <!-- <div class="offer-card" data-program="1-week">
        <div class="offer-left">
          <div class="duration"><strong>1-Week Program</strong></div>
          <p class="card-subtext">Tailored intro ‚Äî no card required.</p>
          <div class="full-price" data-full-price="¬£24.99">
            <span class="price-strikethrough" id="price1WeekFull">¬£24.99</span>
            <span class="discount-price" id="price1WeekDiscount">FREE!</span>
          </div>
        </div>
        <div class="offer-right">
          <div class="currency-tag">GBP</div>
          <div class="cost-per-day">
            <strong id="costPerDay1Week">¬£0.00</strong>
          </div>
          <div class="per-day">per day</div>
        </div>
        <div class="additional-info" style="display:none;">
          <h4>What‚Äôs inside this plan</h4>
          <ul class="offer-includes">
            <li>üèãÔ∏è <strong>7-day workout plan</strong> tailored using your onboarding answers</li>
            <li>üìà <strong>Simple progress tracking</strong> to stay on course</li>
            <li>üìÖ One-time payment, no ongoing fees</li>
          </ul>
        </div>
        <div class="toggle-details" style="cursor:pointer;">See more</div>
      </div> -->
      <!-- END 1-WEEK CARD -->

      <!-- Row 2: Two Side-by-Side Cards for 4-Week and 12-Week Programs -->
      <!-- <div class="offer-row">
        <div class="offer-card half-width" data-program="4-week">
          <div class="offer-left">
            <div class="duration"><strong>4-Week Program</strong></div>
            <div class="full-price" data-full-price="¬£99.99">
              <span id="price4WeekFull">¬£99.99</span>
            </div>
          </div>
          <div class="offer-right">
            <div class="currency-tag">GBP</div>
            <div class="cost-per-day">
              <strong id="costPerDay4Week">¬£3.57</strong>
            </div>
            <div class="per-day">per day</div>
          </div>
          <div class="additional-info" style="display:none;">
            <h4>What‚Äôs inside this plan</h4>
            <ul class="offer-includes">
              <li>üèãÔ∏è <Strong>4-week workout plan</Strong> tailored using your onboarding answers</li>
              <li>üìà <Strong>Simple progress tracking</Strong> to stay on course</li>
              <li>üìÖ One-time payment, no ongoing fees</li>
            </ul>
          </div>
          <div class="toggle-details" style="cursor:pointer;">See more</div>
        </div>
        <div class="offer-card half-width" data-program="12-week">
          <div class="offer-left">
            <div class="duration"><strong>12-Week Program</strong></div>
            <div class="full-price" data-full-price="¬£149.99">
              <span id="price12WeekFull">¬£149.99</span>
            </div>
          </div>
          <div class="offer-right">
            <div class="currency-tag">GBP</div>
            <div class="cost-per-day">
              <strong id="costPerDay12Week">¬£1.79</strong>
            </div>
            <div class="per-day">per day</div>
          </div>
          <div class="additional-info" id="info-new" style="display:none;">
            <h4>What‚Äôs inside this plan</h4>
            <ul class="offer-includes">
              <li>üèãÔ∏è <Strong>12-week workout plan</Strong> built from your onboarding answers</li>
              <li>üçΩÔ∏è <Strong>Macro-matched meals</Strong> and <Strong>smart progress tracking</Strong></li>
              <li>üìÖ One-time payment ‚Äî no ongoing fees</li>
            </ul>
          </div>
          <div class="toggle-details" style="cursor:pointer;">See more</div>
        </div>
      </div> -->

      <!-- Row 3: New Special Offer Card (Full Width) -->
      <div class="offer-card offer-special" data-program="new">
        <div class="offer-left">
          <div class="duration"><strong>Pro Tracker</strong></div>
          <div class="full-price" data-full-price="¬£49.99">
            <span class="price-strikethrough" id="priceSpecialFull">¬£49.99</span>
            <span class="discount-price" id="priceSpecialDiscount">¬£0.99</span>
          </div>
          <div class="best-seller-banner">
            <strong><span class="crown-emoji">üëë</span> <span class="banner-text">BEST VALUE</span></strong>
          </div>
        </div>

        <div class="offer-right">
          <div class="currency-tag">GBP</div>
          <div class="cost-per-day">
            <strong id="costPerDaySpecial">¬£0.33</strong>
          </div>
          <div class="per-day">per day</div>
        </div>

        <!-- Moved .additional-info outside .offer-left so it can span the entire card -->
        <div class="additional-info" id="info-new" style="display: none;">
          <h4>Your Complete Fitness Solution</h4>
          <ul class="offer-includes">
            <li>üèãÔ∏è<Strong> Workouts that adapt</Strong> based on your performance and feedback</li>
            <li>üçΩÔ∏è <Strong>Meals that match your routine</Strong> and update as you go</li>
            <li>üìà <Strong>Progress tools that respond to your effort</Strong> and keep you moving forward
            </li>
          </ul>
        </div>

        <div class="toggle-details" id="toggle-new" style="cursor:pointer;">
          What‚Äôs Included?
        </div>
      </div>

      <p class="pricing-justification">
        Like having a personal trainer in your pocket ‚Äî for less than the cost of one session.
      </p>

      <!-- FINISH BUTTON -->
      <div class="offer-finish">
        <button class="finish-btn" id="offerFinishBtn">
          Continue
        </button>
      </div>

      <p class="final-reassurance" id="offerDisclaimer">
        Try the 12-Week Plan risk-free. Cancel anytime ‚Äî no commitment, no hidden fees.
      </p>

      <p class="offer-disclaimer">
        By proceeding, you confirm that you‚Äôve read and agree to our
        <a href="tos.html" target="_blank">terms of service</a> and
        <a href="refund-policy.html" target="_blank">refund policy</a>.
        If you choose the 12-Week Plan, it renews at <span class="renew-amt"></span>/month unless cancelled.
        Cancellations take effect at the end
        of the current billing cycle.
      </p>

  </section>

  <section id="loadingSection" class="loading-section" style="display: none;">
    <p id="loadingText">Loading...</p>
  </section>

  <div class="payment-wrapper">
    <!-- this is the overlay rectangle -->
    <!-- <div class="payment-overlay"></div> -->

    <!-- PAYMENTS: PayPal (default)  |  Card / Apple¬†Pay (Stripe) -->
    <section id="paymentSection" class="payment-section preload-hide">
      <span id="paymentCloseBtn" class="payment-close" aria-label="Close">&times;</span>

      <!-- tab header -->
      <div id="pay-toggle" class="pay-toggle" role="tablist">
        <button type="button" data-pay="paypal" class="toggle-btn active" role="tab" aria-selected="true">
          <img src="../assets/paypal-mark.webp" alt="" class="pay-pill-icon" />
          PayPal
        </button>

        <!-- Card / Apple¬†Pay / G¬†Pay tab -->
        <button type="button" data-pay="card" class="toggle-btn" role="tab" aria-selected="false">
          Card
          <img src="../assets/apple-pay-mark.webp" alt="Apple¬†Pay" class="pay-pill-icon" />
          <img src="../assets/google-gpay.webp" alt="Google¬†Pay" class="pay-pill-icon" />
        </button>

        <!-- this is the coloured slider that slides under the active button -->
        <span class="toggle-slider" aria-hidden="true"></span>
      </div>
      <p id="planSummary" class="plan-summary"></p>
      <!-- PayPal -->
      <!-- <div id="paypalMarkContainer" style="margin-top:20px;"></div> -->

      <!-- keep this: SDK renders the real button inside -->
      <div id="paypal-button-container" class="visually-hidden"></div>

      <!-- PayPal SDK: GBP, vault, capture, buttons -->
      <!-- <script
        src="https://www.paypal.com/sdk/js?client-id=AcygnP6DJSFGbIeyUa2BdGdznCQQk-qXjMEMijIZJeTbzkIltNVCGL5k1i2DdcNR24qoGTDPF_FD_VQ8&vault=true&intent=capture&components=buttons&currency=GBP"></script> -->

      <!-- Where the button will render -->
      <div id="paypal-btn" style="margin-top:16px;"></div>
      <script>
        document.addEventListener('DOMContentLoaded', async () => {
          try {
            // Get client token from your server
            const ctRes = await fetch('/api/paypal/client-token');
            if (!ctRes.ok) throw new Error('client-token failed: ' + (await ctRes.text()));
            const { client_token } = await ctRes.json();

            // Dynamically load the SDK and attach the client token on the script tag
            await new Promise((resolve, reject) => {
              const s = document.createElement('script');
              s.src = 'https://www.paypal.com/sdk/js?client-id=AcygnP6DJSFGbIeyUa2BdGdznCQQk-qXjMEMijIZJeTbzkIltNVCGL5k1i2DdcNR24qoGTDPF_FD_VQ8&vault=true&intent=capture&components=buttons&currency=GBP&disable-funding=card,credit';
              s.setAttribute('data-client-token', client_token);
              s.onload = resolve;
              s.onerror = () => reject(new Error('PayPal SDK failed to load'));
              document.head.appendChild(s);
            });

            // Now render the button
            paypal.Buttons({
              createOrder: async () => {
                const r = await fetch('/api/paypal/create-order-otp', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ amount: '0.99' })
                });
                if (!r.ok) throw new Error('create-order failed: ' + (await r.text()));
                const { id } = await r.json();
                return id;
              },

              onApprove: async (data) => {
                const r = await fetch(`/api/paypal/capture/${data.orderID}`, { method: 'POST' });
                if (!r.ok) throw new Error('capture failed: ' + (await r.text()));
                const { capture, vault_id, vault_status } = await r.json();

                console.log('PayPal capture:', capture);
                console.log('vault_id:', vault_id);

                const userId = localStorage.getItem('userId');
                if (vault_id && vault_status === 'VAULTED') {
                  await fetch('/api/paypal/save-vault', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      userId,
                      vault_id,
                      orderID: data.orderID,
                      captureID: capture?.purchase_units?.[0]?.payments?.captures?.[0]?.id
                    })
                  });
                } else {
                  console.log('Vaulting pending (status:', vault_status, '). Will be saved via webhook.');
                }
                try {
                  await fetch('/api/paypal/save-vault', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      userId,
                      vault_id,
                      orderID: data.orderID,
                      captureID: capture?.purchase_units?.[0]?.payments?.captures?.[0]?.id
                    })
                  });
                } catch (e) {
                  console.warn('save-vault failed (non-blocking)', e);
                }

                window.location.href = '/pages/dashboard.html';
              },

              onError: (err) => {
                console.error('PayPal error', err);
                alert('There was a problem finishing checkout. Please try again.');
              }
            }).render('#paypal-btn');
          } catch (e) {
            console.error(e);
            alert('Could not initialise PayPal. Please refresh and try again.');
          }
        });
      </script>


      <!-- Stripe -->
      <form id="paymentForm" style="display:none;">
        <div id="payment-request-button"></div>
        <div id="paymentElement" style="margin-top:24px;"></div>

        <button id="paySubmitBtn" class="pay-btn" type="submit">üîí Pay</button>
        <div class="card-logos">
          <img src="../assets/visa.png" alt="Visa" class="visa" />
          <img src="../assets/mastercard.png" alt="Mastercard" />
          <img src="../assets/amex.png" alt="American Express" />


          <!-- <img src="../assets/discover.png" alt="Discover" /> -->
        </div>
      </form>

      <!-- loaders / messages -->
      <p id="loadingIndicator" style="display:none;text-align:center;margin-top:12px;font-weight:500;color:#333;">
        Loading
      </p>
      <p id="postPayNote" class="post-pay-note" style="display:none;text-align:center;margin-top:12px;">
        ‚úÖ <strong>After payment, your 12‚ÄëWeek Plan unlocks immediately</strong> ‚Äì you‚Äôll be taken to your dashboard.

        <!-- ‚Üì  wrap just this sentence ‚Üì -->
        <!-- <span id="paypalCancelNote" style="display:none;">
          <br><br>üí° <strong>Just 99p.¬†Cancel anytime via</strong>
          <a href="mailto:info@raisingthebarapp.com" style="font-weight:600;color:#007bff;text-decoration:underline;">
            info@raisingthebarapp.com
          </a> ‚Äî you‚Äôll keep access for 30¬†days.
        </span> -->
      </p>
      <p id="cardError" class="error"></p>
    </section>


    <section class="money-back-guarantee ">
      <div class="mbg-container">
        <div class="mbg-content">
          <h2>100% Money-Back Guarantee</h2>
          <p>
            We're confident in the effectiveness of our programs. Achieve visible results in just 4 weeks, or get your
            money back!
            If you don't see results within 30 days, and you've followed the plan, we'll provide a full refund‚Äîno
            hassle.
          </p>
          <p>
            <a href="refund-policy.html" class="mbg-link">Learn more about our refund policy</a>.
          </p>
        </div>
      </div>
  </div>
  </section>

  <!-- FAQ Section -->
  <section class="faq-section ">
    <h2 class="faq-heading">Still have questions?</h2>
    <div class="faq-container">
      <div class="faq-item">
        <button class="faq-question">What exactly do I get when I join?</button>
        <div class="faq-answer">
          <p>You‚Äôll get instant access to your personalized fitness tracker ‚Äî with tailored workouts, meals, habit
            tracking, progress tools, and insights that evolve with you. It‚Äôs all online, accessible 24/7, and built
            around your exact answers during onboarding.</p>
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">Is this just a plan, or something more interactive?</button>
        <div class="faq-answer">
          <p>It‚Äôs far more than a plan. This is a live, adaptive tracker that responds to your feedback, tracks your
            streaks, progression, and nutrition, and helps you stay on track with minimal guesswork. You don‚Äôt just
            follow it ‚Äî you interact with it daily.</p>
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">What if I‚Äôm a beginner or haven‚Äôt worked out in a while?</button>
        <div class="faq-answer">
          <p>That‚Äôs exactly who it‚Äôs built for. The tracker meets you where you are and progresses gradually. No
            intimidating jumps, no overwhelm ‚Äî just a smart path forward that builds confidence session by session.
          </p>
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">How is this different from a fitness app or YouTube workout?</button>
        <div class="faq-answer">
          <p>Most apps throw generic workouts at you. This is different ‚Äî everything is built around your body, goals,
            and feedback. It‚Äôs like having a personal trainer, nutritionist, and accountability coach ‚Äî in one
            connected
            system ‚Äî without the ¬£60/hr price tag.
          </p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question">What if I change my mind after joining?</button>
        <div class="faq-answer">
          <p>You‚Äôre covered. Try the tracker risk-free ‚Äî if you don‚Äôt love it, you‚Äôll get a full refund. No hassle, no
            hoops, just email support within the refund window.</p>
        </div>
      </div>
    </div>
  </section>

  <div class="testimonial-section ">
    <h2>See What Happens When Everything Connects</h2>
    <p class="hero-text">
      Progress from real people, using the same system you're about to unlock.
    </p>

    <div class="testimonial-container">
      <!-- Desktop Arrows (hidden on mobile) -->
      <button class="arrow-button prev">‚ùÆ</button>

      <!-- Slider that holds all testimonial cards -->
      <div class="testimonial-slider">
        <!-- Populated by JS -->
      </div>

      <button class="arrow-button next">‚ùØ</button>
    </div>
  </div>

  <div class="dots-container "></div>

  <p class="trust-line">
    Built by a small team of lifters, developers, and designers who‚Äôve been exactly where you are.
  </p>

  <footer class="footer " id="footer">
    <div class="footer-content">
      <p>&copy; 2025 Raising The Bar App Ltd. All rights reserved.</p>
      <div class="footer-links">
        <a href="index.html">Start Training</a>
        <span class="separator">|</span>
        <a href="legal-overview.html">Our Policies</a>
        <span class="separator">|</span>
        <a href="contact-us.html">Contact Us</a>
      </div>
      <div class="social-icons">
        <a href="https://www.instagram.com/raising_the_bar_app/?hl=en" target="_blank" aria-label="Instagram">
          <img src="../assets/instagram-icon.png" alt="Instagram">
        </a>
        <a href="https://www.youtube.com/@Raising_The_Bar_App" target="_blank" aria-label="YouTube">
          <img src="../assets/youtube-icon.png" alt="YouTube">
        </a>
        <a href="https://www.youtube.com/@Raising_The_Bar_App" target="_blank" aria-label="TikTok">
          <img src="../assets/tiktok-icon.png" alt="TikTok">
        </a>
      </div>
    </div>
  </footer>
  <div id="compareModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>

      <h2>Compare¬†Plans</h2>
      <p class="subtext">Here's what you unlock when using our 12-Week Plan.</p>

      <div class="table-wrapper">
        <table class="compare-table">
          <colgroup>
            <col class="col-feature">
            <col class="col-ct">
            <col class="col-pt">
          </colgroup>
          <thead>
            <tr>
              <th>Feature</th>
              <th>Most Apps</th>
              <th>Raising The Bar</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Workout Logging</td>
              <td>‚úÖ</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Adaptive Progression</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Progress Score</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>My Progress (Trends &amp; Insights)</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Coach Feedback &amp; Weekly Insights</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Nutrition Tracker</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Macro-Matched Meals</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Meal Prep Mode &amp; Shopping List</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>XP Bonuses &amp; Weekly Recaps</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
            <tr>
              <td>Video Tutorials</td>
              <td>‚ùå</td>
              <td>‚úÖ</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="testimonial">
        ‚ÄúI didn't realize how much I was missing until I unlocked the 12-Week Plan. It made everything click.‚Äù
        - Alice, lost 7 kg
      </p>
    </div>
  </div>

  <div id="valueModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>

      <h2 id="valueModalHeader">üéâ , you've been selected ‚Äî start now for just 99p</h2>

      <p class="subtext">
        <strong>Most plans fail because they're too rigid</strong><br><br>
        This one adapts as you go - based on your real results.
      </p>

      <ul class="feature-list">
        <li>‚úì Miss a workout? Your plan adjusts.</li>
        <li>‚úì Meals not working? Swap them with 1 click.</li>
        <li>‚úì Track progress ‚Äî XP, streaks, graphs & more.</li>
      </ul>

      <p class="note">
        üí° This isn‚Äôt a fixed plan. It‚Äôs a <strong>smart tracker</strong> that adapts as you go.
      </p>

      <div class="modal-actions">
        <button id="valueContinue" class="primary-btn">Continue</button>
        <a id="valueDemo" href="https://www.youtube.com/shorts/H_aOWlPujIg" target="_blank" rel="noopener"
          class="secondary-btn">
          Watch&nbsp;Demo
        </a>
      </div>
      <p class="urgency-note">
        ‚è≥ <strong>Claim your plan before the discount ends.</strong>
      </p>
      <!-- <p class="skip-link">
        <a href="#" id="valueSkip">No thanks, just take me to the plan</a>
      </p> -->
    </div>
  </div>

  <script>
    let scrollTracked = false;

    window.addEventListener('scroll', () => {
      const scrollPosition = window.scrollY + window.innerHeight;
      const pageHeight = document.body.offsetHeight;

      if (!scrollTracked && scrollPosition / pageHeight > 0.75) {
        scrollTracked = true;
        if (window.ttq) {
          ttq.track('ViewContent', {
            content_name: '75% Scroll - Landing Page'
          });
        }
      }
    });
  </script>
  <script>
    // Lightweight currency bootstrap (v1)
    ; (function () {
      const saved = localStorage.getItem('rtb_currency');
      if (saved) { window.RTB_CURRENCY = JSON.parse(saved); return; }

      // Minimal map for initial regions. Extend as you add markets.
      const COUNTRY_TO_CURRENCY = {
        SE: { code: 'SEK', symbol: 'kr', minor: 2, fxFromGBP: 13.50 }, // 1 GBP ‚âà 13.5 SEK (update periodically)
        US: { code: 'USD', symbol: '$', minor: 2, fxFromGBP: 1.30 },
        GB: { code: 'GBP', symbol: '¬£', minor: 2, fxFromGBP: 1.00 },
        IE: { code: 'EUR', symbol: '‚Ç¨', minor: 2, fxFromGBP: 1.18 },
        DE: { code: 'EUR', symbol: '‚Ç¨', minor: 2, fxFromGBP: 1.18 },
        FR: { code: 'EUR', symbol: '‚Ç¨', minor: 2, fxFromGBP: 1.18 },
        AU: { code: 'AUD', symbol: '$', minor: 2, fxFromGBP: 1.95 },
        CA: { code: 'CAD', symbol: '$', minor: 2, fxFromGBP: 1.75 }
      };

      function pickByLocale() {
        try {
          const loc = Intl.DateTimeFormat().resolvedOptions().locale || '';
          const cc = (loc.split('-')[1] || '').toUpperCase();
          if (COUNTRY_TO_CURRENCY[cc]) return { country: cc, ...COUNTRY_TO_CURRENCY[cc] };
        } catch { }
        return { country: 'GB', ...COUNTRY_TO_CURRENCY.GB };
      }

      window.RTB_CURRENCY = pickByLocale();
      localStorage.setItem('rtb_currency', JSON.stringify(window.RTB_CURRENCY));
    })();
  </script>
  <script src="../scripts/offer.js"></script>
  <!-- leave Stripe.js -->

  <!-- then YOUR payment.js ‚Äì pick one path and delete the other -->
  <!-- <script src="../scripts/paypal.js?v=20250716"></script> -->
  <script src="../scripts/payment.js?v=20250711"></script>

</body>

</html>